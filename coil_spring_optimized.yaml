# coil_spring_optimized.yaml (v2) - Optimized Stage 1 Configuration
# Created: 2025-09-21
# Last Edited: 2025-09-21
#
# Purpose:
# Final optimized Stage 1 configuration with all four dials tuned:
# 1. max_fast3_width_pct: 2.0% (Dial 1)
# 2. max_tr_range_atr: 1.2 (Dial 2)  
# 3. require_sma150_slope_bps_min: -0.20% (Dial 3 - Moderate Tolerance)
# 4. min_bars_in_coil: 1 (Dial 4 - Permissive)

control:
  enabled_stages: ["coil_1h"]  # ONLY Stage 1 enabled
  benchmark: false

universe:
  regex: ".*"
  exclude_symbols:
    # Stablecoins
    - EURUSDT
    - EURIUSDT
    - FDUSDUSDT
    - USD1USDT
    - USDCUSDT
    - BUSDUSDT
    - TUSDUSDT
    - DAIUSDT
    - USDPUSDT
    - PAXGUSDT
    - BFUSDUSDT
    - USDEUSDT
    # Barcode coins (low volatility, flat price action)
    - BTTCUSDT
    - XUSDUSDT

features:
  ema_fast: 21
  ema_mid_fast: 40
  sma_mid_slow: 50
  sma_slow: 150
  atr_window: 14
  slope_window: 100

# Stage 1: 1h Coil Detection - OPTIMIZED PARAMETERS
coil_1h:
  price_col: close
  
  # DIAL 1: Coil tightness criteria - OPTIMIZED
  max_fast3_width_pct: 2.0      # EMA21–EMA40–SMA50 tightness on 1h
  
  # DIAL 2: Volatility guard - OPTIMIZED  
  max_tr_range_atr: 1.2          # volatility guard (true-range/ATR)
  
  # DIAL 3: SMA150 slope - MODERATE TOLERANCE
  require_sma150_slope_bps_min: -0.20  # ≥ -0.20% (moderate bearishness allowed)
  
  # DIAL 4: Bars in coil - PERMISSIVE
  min_bars_in_coil: 1            # Very permissive - only 1 bar needed
  min_ma21_slope_pct: -10.0      # Very permissive - allows any slope

# Stage 2: 4h Matching - DISABLED
match_4h:
  mode: "either"
  max_fast3_width_pct: 10.0
  min_bars_in_coil: 1
  min_ma21_slope_pct: -0.5
  min_ma50_slope_pct: -0.5

# Stage 3: Daily Confirmation - DISABLED
confirm_1d:
  min_sma150_slope_pct: 0.0
  tolerance_pct: 0.0

# Output configuration
outputs:
  save_watchlists: true
  out_dir: "out"
  rules: ["1h:coil_pass"]  # Only Stage 1 rules

# Optimized Parameters Summary:
# - Dial 1: max_fast3_width_pct: 2.0% (89% pass rate)
# - Dial 2: max_tr_range_atr: 1.2 (95.4% pass rate)  
# - Dial 3: require_sma150_slope_bps_min: -0.20% (20.4% pass rate)
# - Dial 4: min_bars_in_coil: 1 (permissive)
# - Expected result: ~69 symbols passing Stage 1
