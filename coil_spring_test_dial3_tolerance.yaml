# coil_spring_test_dial3_tolerance.yaml - Test Dial 3: Slight Tolerance (≥ -0.10%)
# Created: 2025-09-21
# Last Edited: 2025-09-21
#
# Purpose:
# Test Dial 3 with slight tolerance threshold (≥ -0.10%)
# Expected: ~66 symbols (19.5% of 338)

control:
  enabled_stages: ["coil_1h"]  # ONLY Stage 1 enabled
  benchmark: false

universe:
  regex: ".*"
  exclude_symbols:
    # Stablecoins
    - EURUSDT
    - EURIUSDT
    - FDUSDUSDT
    - USD1USDT
    - USDCUSDT
    - BUSDUSDT
    - TUSDUSDT
    - DAIUSDT
    - USDPUSDT
    - PAXGUSDT
    - BFUSDUSDT
    # Barcode coins
    - BTTCUSDT
    - XUSDUSDT

features:
  ema_fast: 21
  ema_mid_fast: 40
  sma_mid_slow: 50
  sma_slow: 150
  atr_window: 14
  slope_window: 100

# Stage 1: 1h Coil Detection - ALL FOUR DIALS ACTIVE
coil_1h:
  price_col: close
  
  # DIAL 1: Coil tightness criteria
  max_fast3_width_pct: 2.0
  
  # DIAL 2: Volatility guard  
  max_tr_range_atr: 1.2
  
  # DIAL 3: SMA150 slope - SLIGHT TOLERANCE
  require_sma150_slope_bps_min: -0.10  # ≥ -0.10% (slight bearishness allowed)
  
  # DIAL 4: Bars in coil (permissive)
  min_bars_in_coil: 1
  min_ma21_slope_pct: -10.0

match_4h:
  mode: "either"
  max_fast3_width_pct: 10.0
  min_bars_in_coil: 1
  min_ma21_slope_pct: -0.5
  min_ma50_slope_pct: -0.5

confirm_1d:
  min_sma150_slope_pct: 0.0
  tolerance_pct: 0.0

outputs:
  save_watchlists: true
  out_dir: "out"
  rules: ["1h:coil_pass"]
